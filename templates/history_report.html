<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Find Total History of a day and sent it via email</h1>
    <div class="mb-5">
        <label for="dateInput" class="form-label">Enter Start Date</label>
        <input id="dateInput" type="date" class="form-control" required>
    </div>
    <div class="mb-6">
        <label for="dateInput2" class="form-label">Enter End Date</label>
        <input id="dateInput2" type="date" class="form-control" required>
    </div>
    <button id="formSubmitBtn" type="submit" class="btn btn-primary" onclick="sendDataMail(event)">Submit</button>

    <div>
        <p id="email-status"></p>
    </div>
      <script>
            function sendDataMail(){
                document.getElementById('email-status').innerHTML = ''

                let startDate = document.getElementById('dateInput').value; 
                let endDate = document.getElementById('dateInput2').value; 
                // console.log(dateinput);
                const url = 'http://127.0.0.1:8000/api/send-report-range/'; // Replace with the actual URL for the send_report_range view

                // Create the start and end date parameters
                // Construct the URL with query parameters
                const urlWithParams = `${url}?start_date=${encodeURIComponent(startDate)}&end_date=${encodeURIComponent(endDate)}`;
                console.log(urlWithParams);
                // Make the fetch request
                fetch(urlWithParams)
                .then(response => {
                    // Handle the response
                    console.log("response: " + response)
                    if (response.ok) {
                        return response.json(); // Parse the response as JSON
                    } else {
                        throw new Error('Error: ' + response.status);
                    }
                })
                .then(data => {
                    // Process the data returned by the server
                    console.log(data);
                    document.getElementById('email-status').innerHTML = "Email sent. check your email"
                })
                .catch(error => {
                    // Handle any errors that occur during the request
                    // document.getElementById('email-status').innerHTML = "Some error occurred"
                    // console.error("Error Occured: " + JSON.stringify(error));
                    // console.error("error: " + error)
                    console.error(error)
                });
            }

        //   function getFormInput(){
        //     let dateInput = document.getElementById('dateInput').value;
        //     console.log(dateInput); 
        //     let url = 'http://127.0.0.1:8000/api/expense-history/' + dateInput ;
        //     console.log(url); 
            
        //     fetch(url).then(response => {
        //         if(!response.ok){
        //             throw new Error('Request failed with status ' + response.status);
        //         }
        //         return response.json(); 
        //     })
        //     .then(data => {
        //         const expenseTable = document.getElementById('expenseTable');
        //         while (expenseTable.rows.length > 1){
        //             expenseTable.deleteRow(1);
        //         }
        //         console.log(expenseTable);
        //         data.forEach(expense => {
        //             const row = expenseTable.insertRow();
        //             // Create table cells for each expense field
        // const dateCell = row.insertCell();
        // const amountCell = row.insertCell();
        // const categoryCell = row.insertCell();
        // const notesCell = row.insertCell();

        // // Populate the table cells with expense data
        // dateCell.textContent = expense.date;
        // amountCell.textContent = expense.amount;
        // categoryCell.textContent = expense.category;
        // notesCell.textContent = expense.notes;
        //         });
        //     })
        //     .catch(error => {
        //         console.error(error);
        //     });
        //   }
      </script>
</body>
</html>